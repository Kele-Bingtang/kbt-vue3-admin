<template>
  <div :class="prefixClass">
    <el-card shadow="never" style="margin-bottom: 10px">
      <template #header>
        <el-link
          href="https://github.com/inorganik/countUp.js"
          target="_blank"
          :underline="false"
          style="font-size: 20px"
        >
          CountUp.js
        </el-link>
      </template>
    </el-card>

    <el-row :gutter="20">
      <el-col :span="4">
        <el-card shadow="hover">
          <template #header>
            <span>åŸºç¡€ç”¨æ³•</span>
          </template>
          <div class="count-to-content">
            <CountTo :start-val="0" :end-val="2727" count-class="count-text" />
          </div>
        </el-card>
      </el-col>

      <el-col :span="5">
        <el-card shadow="hover">
          <template #header>
            <span>æ·»åŠ å‰ç¼€å’Œåç¼€</span>
          </template>
          <div class="count-to-content">
            <CountTo :start-val="0" :end-val="2727" prefix="Lucky " suffix=" Num" count-class="count-text" />
          </div>
        </el-card>
      </el-col>

      <el-col :span="7">
        <el-card shadow="hover">
          <template #header>
            <span>ä¿ç•™ 2 ä½å°æ•°ç‚¹ & å¾ªç¯ä¸‰æ¬¡</span>
          </template>
          <div class="count-to-content">
            <CountTo :start-val="0" :end-val="2727" :decimals="2" :loop="3" count-class="count-text" />
          </div>
        </el-card>
      </el-col>

      <el-col :span="8">
        <el-card shadow="hover">
          <template #header>
            <span>åŠ¨ç”»æŒç»­ 10 ç§’</span>
          </template>
          <div class="count-to-content">
            <CountTo
              :start-val="0"
              :end-val="2727"
              :decimals="2"
              :duration="10"
              :use-easing="false"
              count-class="count-text"
            />
          </div>
        </el-card>
      </el-col>
    </el-row>

    <el-row :gutter="20" class="count-to-row">
      <el-col :span="8">
        <el-card shadow="hover" style="height: 270px">
          <template #header>
            <span>å•ä½è½¬æ¢ï¼ˆè‡ªå¸¦ï¼‰</span>
          </template>
          <div class="count-to-content">
            <CountTo
              :simplify="true"
              :end-val="27272"
              prefix="åŸå§‹æ•°æ®ï¼š27272 => "
              count-class="count-text"
              unit-class="unit-class"
            />
            <CountTo
              :simplify="true"
              :end-val="27272727"
              prefix="åŸå§‹æ•°æ®ï¼š27272727 => "
              count-class="count-text"
              unit-class="unit-class"
            />
            <CountTo
              :simplify="true"
              :end-val="27272727277"
              prefix="åŸå§‹æ•°æ®ï¼š27272727277 => "
              count-class="count-text"
              unit-class="unit-class"
            />
          </div>
        </el-card>
      </el-col>

      <el-col :span="8">
        <el-card shadow="hover">
          <template #header>
            <span>è‡ªå®šä¹‰å•ä½</span>
          </template>
          <div class="count-to-content">
            <CountTo
              :simplify="true"
              :end-val="2727"
              :unit="customUnit"
              count-class="count-text"
              unit-class="unit-class"
            >
              <template #prefix>åŸå§‹æ•°æ®ï¼š2727 =>&nbsp;</template>
            </CountTo>

            <CountTo
              :simplify="true"
              :end-val="27272"
              :unit="customUnit"
              count-class="count-text"
              unit-class="unit-class"
            >
              <template #prefix>åŸå§‹æ•°æ®ï¼š27272 =>&nbsp;</template>
            </CountTo>

            <CountTo
              :simplify="true"
              :end-val="272727"
              count-class="count-text"
              :unit="customUnit"
              unit-class="unit-class"
            >
              <template #prefix>åŸå§‹æ•°æ®ï¼š272727 =>&nbsp;</template>
            </CountTo>
          </div>
        </el-card>
      </el-col>

      <el-col :span="8">
        <el-card shadow="hover" style="height: 270px">
          <template #header>
            <span>å¼‚æ­¥æ›´æ–°æ•°æ®</span>
          </template>
          <div class="count-to-content" style="line-height: 149px">
            <CountTo :end-val="asyncEndVal" count-class="count-text" />
          </div>
        </el-card>
      </el-col>
    </el-row>

    <el-row class="count-to-row">
      <el-card shadow="hover">
        <template #header>
          <span>
            å®Œæ•´ Demoï¼š &lt;CountTo :start-val=&#x27;{{ startVal }}&#x27; :end-val=&#x27;{{ endVal }}&#x27;
            :duration=&#x27;{{ duration }}&#x27; :decimals=&#x27;{{ decimals }}&#x27; :separator=&#x27;{{
              separator
            }}&#x27; :prefix=&#x27;{{ prefix }}&#x27; :suffix=&#x27;{{ suffix }}&#x27; :autoplay=&#x27;false&#x27;
            :loop=&#x27;{{ loop }}&#x27; /&gt;
          </span>
        </template>
        <div class="count-to-content">
          <CountTo
            ref="countRef"
            :start-val="startVal"
            :end-val="endVal"
            :duration="duration"
            :decimals="decimals"
            :separator="separator"
            :prefix="prefix"
            :suffix="suffix"
            :autoplay="false"
            :loop="loop"
            class="count-demo"
          />
          <el-form :inline="true" :model="countToParams" class="demo-form-inline">
            <el-form-item label="èµ·å§‹å€¼ï¼š">
              <el-input v-model="countToParams.startVal" placeholder="startVal"></el-input>
            </el-form-item>
            <el-form-item label="ç»“æŸå€¼ï¼š">
              <el-input v-model="countToParams.endVal" placeholder="endVal"></el-input>
            </el-form-item>
            <el-form-item label="æŒç»­æ—¶é—´ï¼š">
              <el-input v-model="countToParams.duration" placeholder="duration"></el-input>
            </el-form-item>
            <el-form-item label="ä¿ç•™å°æ•°ï¼š">
              <el-input v-model="countToParams.decimals" placeholder="decimals"></el-input>
            </el-form-item>
            <el-form-item label="åˆ†éš”ç¬¦ï¼š">
              <el-input v-model="countToParams.separator" placeholder="separator"></el-input>
            </el-form-item>
            <el-form-item label="å‰ç¼€ï¼š">
              <el-input v-model="countToParams.prefix" placeholder="prefix"></el-input>
            </el-form-item>
            <el-form-item label="åç¼€ï¼š">
              <el-input v-model="countToParams.suffix" placeholder="suffix"></el-input>
            </el-form-item>
            <el-form-item label="å¾ªç¯ï¼š">
              <el-input v-model="countToParams.loop" placeholder="loop"></el-input>
            </el-form-item>
            <el-form-item>
              <el-button type="primary" @click="start">Start</el-button>
              <el-button type="primary" @click="pauseResume">Pause/Resume</el-button>
              <el-button type="primary" @click="reset">Reset</el-button>
            </el-form-item>
          </el-form>
        </div>
      </el-card>
    </el-row>

    <el-card shadow="never" style="margin-top: 10px">
      <el-descriptions title="é…ç½®é¡¹ ğŸ“š" :column="1" border>
        <el-descriptions-item label="init">
          åˆå§‹å€¼ï¼Œåé¢ä¼šè¢« startVal è¦†ç›–ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `0`
        </el-descriptions-item>
        <el-descriptions-item label="startVal">
          èµ·å§‹å€¼ï¼Œå³åŠ¨ç”»å¼€å§‹å‰æ˜¾ç¤ºçš„æ•°å€¼ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `0`
        </el-descriptions-item>
        <el-descriptions-item label="endVal">
          ç»“æŸå€¼ï¼Œå³åŠ¨ç”»ç»“æŸåæ˜¾ç¤ºçš„æ•°å€¼ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `undefined`
        </el-descriptions-item>
        <el-descriptions-item label="prefix">æ•°å€¼çš„å‰ç¼€ã€‚`string` ç±»å‹ï¼Œé»˜è®¤ä¸º `""`</el-descriptions-item>
        <el-descriptions-item label="suffix">æ•°å€¼çš„åç¼€ã€‚`string` ç±»å‹ï¼Œé»˜è®¤ä¸º `""`</el-descriptions-item>
        <el-descriptions-item label="decimals">ä¿ç•™å‡ ä½å°æ•°ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `0`</el-descriptions-item>
        <el-descriptions-item label="decimal">
          åˆ†éš”æ•´æ•°å’Œå°æ•°çš„ç¬¦å·ï¼Œé»˜è®¤æ˜¯å°æ•°ç‚¹ã€‚`string` ç±»å‹ï¼Œé»˜è®¤ä¸º `"."`
        </el-descriptions-item>
        <el-descriptions-item label="duration">
          åŠ¨ç”»æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `3`
        </el-descriptions-item>
        <el-descriptions-item label="delay">
          åŠ¨ç”»å»¶è¿Ÿå¼€å§‹çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `0`
        </el-descriptions-item>
        <el-descriptions-item label="autoplay">
          æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ï¼Œå•ä½æ˜¯ç§’ã€‚`boolean` ç±»å‹ï¼Œé»˜è®¤ä¸º `true`
        </el-descriptions-item>
        <el-descriptions-item label="useEasing">
          æ˜¯å¦ä½¿ç”¨ easing åŠ¨ç”»æ•ˆæœã€‚`boolean` ç±»å‹ï¼Œé»˜è®¤ä¸º `true`
        </el-descriptions-item>
        <el-descriptions-item label="useGroup">
          æ˜¯å¦ä½¿ç”¨åˆ†ç»„ï¼Œåˆ†ç»„åæ¯ä¸‰ä½ä¼šç”¨ä¸€ä¸ªç¬¦å·åˆ†éš”ï¼Œå³ 1000 ä½ 1,000ã€‚`boolean` ç±»å‹ï¼Œé»˜è®¤ä¸º `true`
        </el-descriptions-item>
        <el-descriptions-item label="separator">
          ç”¨äºåˆ†ç»„ï¼ˆuseGroupï¼‰çš„ç¬¦å·ã€‚`string` ç±»å‹ï¼Œé»˜è®¤ä¸º `","`
        </el-descriptions-item>
        <el-descriptions-item label="simplify">
          æ˜¯å¦ç®€åŒ–æ˜¾ç¤ºï¼Œè®¾ä¸º true åä¼šä½¿ç”¨ unit å•ä½æ¥åšç›¸å…³çœç•¥ã€‚`boolean` ç±»å‹ï¼Œé»˜è®¤ä¸º `false`
        </el-descriptions-item>
        <el-descriptions-item label="unit">
          è‡ªå®šä¹‰å•ä½ï¼Œå¦‚ { value: 3, label: "K+" }, { value: 6, label: "M+" } å³å¤§äº 3 ä½æ•°å°äº 6 ä½æ•°çš„ç”¨ k+ æ¥åšçœç•¥
          1000 å³æ˜¾ç¤ºä¸º 1K+ã€‚`Unit[]` ç±»å‹ï¼Œé»˜è®¤ä¸º `[ { value: 3, label: "K+" }, { value: 6, label: "M+" }, { value: 9,
          label: "B+" }, ]`
        </el-descriptions-item>
        <el-descriptions-item label="countClass">count æ•°å­—çš„ classã€‚`string` ç±»å‹ï¼Œé»˜è®¤ä¸º `""`</el-descriptions-item>
        <el-descriptions-item label="unitClass">å•ä½çš„ classã€‚`string` ç±»å‹ï¼Œé»˜è®¤ä¸º `""`</el-descriptions-item>
        <el-descriptions-item label="loop">å¾ªç¯æ¬¡æ•°ã€‚`number` ç±»å‹ï¼Œé»˜è®¤ä¸º `1`</el-descriptions-item>
      </el-descriptions>
    </el-card>

    <el-card shadow="never" style="margin-top: 10px">
      <el-descriptions title="Emits äº‹ä»¶ ğŸ“š" :column="1" border>
        <el-descriptions-item label="init">åˆå§‹åŒ–åäº‹ä»¶ã€‚`(counter: CountUp) => void` ç±»å‹</el-descriptions-item>
        <el-descriptions-item label="finished">æ•°å­—æ¸å˜ç»“æŸäº‹ä»¶ã€‚`() => void` ç±»å‹</el-descriptions-item>
      </el-descriptions>
    </el-card>

    <el-card shadow="never" style="margin-top: 10px">
      <el-descriptions title="Expose å‚æ•° ğŸ“š" :column="1" border>
        <el-descriptions-item label="restart">é‡å¯æ•°å­—æ¸å˜å‡½æ•°ã€‚`(counter: CountUp) => void` ç±»å‹</el-descriptions-item>
        <el-descriptions-item label="pause">æš‚åœæ•°å­—æ¸å˜å‡½æ•°ã€‚`() => void` ç±»å‹</el-descriptions-item>
        <el-descriptions-item label="reset">é‡ç½®æ•°å­—æ¸å˜å‡½æ•°ã€‚`() => void` ç±»å‹</el-descriptions-item>
        <el-descriptions-item label="init">åˆå§‹åŒ–æ•°å­—æ¸å˜å‡½æ•°ã€‚`() => void` ç±»å‹</el-descriptions-item>
      </el-descriptions>
    </el-card>
  </div>
</template>

<script setup lang="ts" name="CountToDemo">
import { CountTo } from "@/components";
import { useDesign } from "@/hooks";

const { getPrefixClass } = useDesign();
const prefixClass = getPrefixClass("count-to-demo");

const customUnit = [
  { value: 3, label: "åƒå¤š" },
  { value: 4, label: "ä¸‡å¤š" },
  { value: 5, label: "åä¸‡å¤š" },
];

const countRef = ref();
const asyncEndVal = ref(199);
const timer = ref<NodeJS.Timer | null>(null);
const countToParams = reactive({
  startVal: 0,
  endVal: 1999,
  duration: 4,
  decimals: 0,
  separator: ",",
  suffix: " Year",
  prefix: "Be ",
  loop: 1,
});

const startVal = computed(() => {
  if (countToParams.startVal) {
    return countToParams.startVal;
  } else {
    return 0;
  }
});

const endVal = computed(() => {
  if (countToParams.endVal) {
    return countToParams.endVal;
  } else {
    return 0;
  }
});
const duration = computed(() => {
  if (countToParams.duration) {
    return countToParams.duration;
  } else {
    return 100;
  }
});

const decimals = computed(() => {
  if (countToParams.decimals) {
    if (countToParams.decimals < 0 || countToParams.decimals > 20) {
      alert("decimals å€¼åº”è¯¥åœ¨ 0 - 20 åŒºé—´å†…");
      return 0;
    }
    return countToParams.decimals;
  } else {
    return 0;
  }
});

const separator = computed(() => countToParams.separator);
const suffix = computed(() => countToParams.suffix);
const prefix = computed(() => countToParams.prefix);
const loop = computed(() => countToParams.loop);

onMounted(() => {
  init();
});

onActivated(() => {
  init();
});

onDeactivated(() => {
  timer.value = null;
});

onBeforeUnmount(() => {
  timer.value = null;
});

const init = () => {
  timer.value = setInterval(() => {
    asyncEndVal.value += parseInt(Math.random() * 30 + "");
  }, 2000);
};

const start = () => {
  countRef.value && countRef.value.restart();
};
const pauseResume = () => {
  countRef.value && countRef.value.pause();
};
const reset = () => {
  countRef.value && countRef.value.reset();
};
</script>

<style lang="scss" scoped>
$prefix-class: #{$admin-namespace}-count-to-demo;

.#{$prefix-class} {
  .count-to-row {
    margin-top: 20px;
  }

  .count-to-content {
    text-align: center;
  }

  .count-demo {
    display: block;
    margin-bottom: 20px;
    font-size: 80px;
    font-weight: 500;
    color: var(--#{$el-namespace}-color-primary);
    text-align: center;
  }

  :deep(.count-text),
  :deep(.unit-class) {
    font-size: 50px;
    color: var(--#{$el-namespace}-color-primary);
  }
}
</style>
