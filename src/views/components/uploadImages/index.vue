<template>
  <div class="upload-images-container">
    <!-- å•å›¾ä¸Šä¼  -->
    <div class="upload-card upload-box">
      <h2>å•å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ ğŸ“ğŸ‡ğŸˆğŸ‰</h2>
      <div class="upload-list">
        <UploadImg v-model:imageUrl="avatar1" @upload-img="uploadImg" :fileSize="3">
          <template #tip>ä¸Šä¼ å›¾ç‰‡æœ€å¤§ä¸º 3M</template>
        </UploadImg>
        <UploadImg v-model:imageUrl="avatar2" @upload-img="uploadImg" :drag="false" borderRadius="50%">
          <template #empty>
            <el-icon><Avatar /></el-icon>
            <span>è¯·ä¸Šä¼ å¤´åƒ</span>
          </template>
          <template #tip>åœ†å½¢ç»„ä»¶ï¼ˆç¦æ­¢æ‹–æ‹½ä¸Šä¼ ï¼‰</template>
        </UploadImg>
        <UploadImg v-model:imageUrl="avatar3" @upload-img="uploadImg" width="250px">
          <template #empty>
            <el-icon><Picture /></el-icon>
            <span>è¯·ä¸Šä¼  Banner å›¾</span>
          </template>
          <template #tip>é•¿æ–¹å½¢ç»„ä»¶ï¼ˆå¯æ‹–æ‹½ä¸Šä¼ ï¼‰</template>
        </UploadImg>
        <UploadImg v-model:imageUrl="avatar4" @upload-img="uploadImg" disabled>
          <template #tip>æ— å›¾ï¼ˆç¦ç”¨ä¸Šä¼ ï¼‰</template>
        </UploadImg>
        <UploadImg v-model:imageUrl="avatar5" @upload-img="uploadImg" disabled>
          <template #tip>æœ‰å›¾ï¼ˆç¦ç”¨ç¼–è¾‘ã€åˆ é™¤ï¼‰</template>
        </UploadImg>
      </div>
      <el-descriptions title="å±æ€§é¡¹ ğŸ“š" :column="1" border>
        <el-descriptions-item label="imageUrl">
          åŒå‘ç»‘å®šçš„ imageUrl å€¼ï¼Œä½¿ç”¨ç¤ºä¾‹ï¼š v-model:imageUrl="avatar"
        </el-descriptions-item>
        <el-descriptions-item label="api">
          ä¸Šä¼ å›¾ç‰‡çš„ api æ–¹æ³•ï¼Œä¸€èˆ¬é¡¹ç›®ä¸Šä¼ éƒ½æ˜¯åŒä¸€ä¸ª api æ–¹æ³•ï¼Œåœ¨ç»„ä»¶é‡Œç›´æ¥å¼•å…¥å³å¯ï¼ˆéå¿…ä¼ ï¼‰
        </el-descriptions-item>
        <el-descriptions-item label="drag">æ˜¯å¦æ”¯æŒæ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ï¼Œé»˜è®¤ä¸º true</el-descriptions-item>
        <el-descriptions-item label="disabled">æ˜¯å¦ç¦ç”¨ ä¸Šä¼ ã€åˆ é™¤ åŠŸèƒ½ï¼Œå¯æŸ¥çœ‹å›¾ç‰‡</el-descriptions-item>
        <el-descriptions-item label="fileSize">å•ä¸ªå›¾ç‰‡æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œé»˜è®¤ä¸º 5M</el-descriptions-item>
        <el-descriptions-item label="fileType">
          å›¾ç‰‡ç±»å‹é™åˆ¶ï¼Œé»˜è®¤ç±»å‹ä¸º ["image/jpeg", "image/png", "image/gif"]
        </el-descriptions-item>
        <el-descriptions-item label="height">ç»„ä»¶é«˜åº¦æ ·å¼ï¼Œé»˜è®¤ä¸º "150px"</el-descriptions-item>
        <el-descriptions-item label="width">ç»„ä»¶å®½åº¦æ ·å¼ï¼Œé»˜è®¤ä¸º "150px"</el-descriptions-item>
        <el-descriptions-item label="borderRadius">ç»„ä»¶è¾¹æ¡†åœ†è§’æ ·å¼ï¼Œé»˜è®¤ä¸º "8px"</el-descriptions-item>
      </el-descriptions>
      <el-descriptions title="æ’æ§½é¡¹ ğŸ“š" :column="1" border>
        <el-descriptions-item label="empty">è‡ªå®šä¹‰æ“ä½œåŒºï¼Œå½“å†…å®¹ä¸ºç©ºæ—¶æ˜¾ç¤º</el-descriptions-item>
        <el-descriptions-item label="tip">è‡ªå®šä¹‰æç¤ºï¼Œæ˜¾ç¤ºåœ¨æ–‡ä»¶ä¸‹æ–¹</el-descriptions-item>
      </el-descriptions>
      <el-descriptions title="äº‹ä»¶é¡¹ ğŸ“š" :column="1" border>
        <el-descriptions-item label="upload-img">
          ä¸Šä¼ æ–‡ä»¶æ—¶çš„å›è°ƒï¼Œæ¥æ”¶çš„å‚æ•°ï¼š
          <el-link style="color: var(--el-color-primary)">file: File, callback: SuccessFun</el-link>
          ã€‚file æ˜¯ä¸Šä¼ çš„æ–‡ä»¶ï¼Œcallback æ˜¯ä¸ªå¿…é¡»çš„å›è°ƒå‡½æ•°ï¼Œå‚æ•°åªæœ‰ä¸€ä¸ªï¼Œä¸ºæ–‡ä»¶çš„ urlã€‚
        </el-descriptions-item>
        <el-descriptions-item label="check-validate">ä¸Šä¼ æ–‡ä»¶æˆåŠŸçš„æ ¡éªŒå›è°ƒ</el-descriptions-item>
      </el-descriptions>
    </div>
    <!-- å¤šå›¾ä¸Šä¼  -->
    <div class="upload-card upload-box">
      <h2>å¤šå›¾ç‰‡ä¸Šä¼ ç»„ä»¶ ğŸ“ğŸ‡ğŸˆğŸ‰</h2>
      <div class="upload-list">
        <UploadImgs v-model:fileList="fileList" @upload-img="uploadImg" :drag="false" borderRadius="50%">
          <template #empty>
            <el-icon><Picture /></el-icon>
            <span>è¯·ä¸Šä¼ ç…§ç‰‡</span>
          </template>
          <template #tip>åœ†å½¢ç»„ä»¶ï¼Œå›¾ç‰‡æœ€å¤§ä¸º 5Mï¼ˆç¦æ­¢æ‹–æ‹½ä¸Šä¼ ï¼‰</template>
        </UploadImgs>
        <UploadImgs v-model:fileList="fileList1" @upload-img="uploadImg" width="250px">
          <template #empty>
            <el-icon><Picture /></el-icon>
            <span>è¯·ä¸Šä¼ ç…§ç‰‡</span>
          </template>
          <template #tip>é•¿æ–¹å½¢ç»„ä»¶ï¼ˆå¯æ‹–æ‹½ä¸Šä¼ ï¼‰</template>
        </UploadImgs>
      </div>
      <el-descriptions title="é…ç½®é¡¹ ğŸ“šï¼ˆå…¶å®ƒå‚æ•°å’Œå•å›¾ä¸Šä¼ ç»„ä»¶ç›¸åŒï¼‰" :column="1" border>
        <el-descriptions-item label="fileList">
          åŒå‘ç»‘å®šçš„ fileList å€¼ï¼Œä½¿ç”¨ç¤ºä¾‹ï¼š v-model:fileList="fileList"
        </el-descriptions-item>
        <el-descriptions-item label="limit">æœ€å¤§å›¾ç‰‡ä¸Šä¼ æ•°ï¼Œé»˜è®¤ä¸º 5 å¼ </el-descriptions-item>
      </el-descriptions>
      <el-descriptions title="æ’æ§½é¡¹ ğŸ“šï¼ˆå…¶å®ƒå‚æ•°å’Œå•å›¾ä¸Šä¼ ç»„ä»¶ç›¸åŒï¼‰" :column="1" border></el-descriptions>
      <el-descriptions title="äº‹ä»¶é¡¹ ğŸ“š" :column="1" border>
        <el-descriptions-item label="upload-img">
          ä¸Šä¼ æ–‡ä»¶æ—¶çš„å›è°ƒï¼Œæ¥æ”¶çš„å‚æ•°ï¼š
          <el-link style="color: var(--el-color-primary)">file: File, callback: SuccessFun</el-link>
          ã€‚file æ˜¯ä¸Šä¼ çš„æ–‡ä»¶ï¼Œcallback æ˜¯ä¸ªå¿…é¡»çš„å›è°ƒå‡½æ•°ï¼Œå‚æ•°åªæœ‰ä¸€ä¸ªï¼Œä¸ºæ–‡ä»¶çš„ urlã€‚
        </el-descriptions-item>
      </el-descriptions>
    </div>
    <!-- è¡¨å•ä½¿ç”¨ -->
    <div class="upload-form-box">
      <div class="upload-card">
        <el-alert
          title="å›¾ç‰‡ä¸Šä¼ ç»„ä»¶åœ¨ form è¡¨å•ä¸­ä½¿ç”¨ï¼Œä¸Šä¼ ä¹‹åæˆåŠŸä¼šè‡ªåŠ¨é‡æ–°æ ¡éªŒ"
          type="warning"
          effect="dark"
          :closable="false"
          style="margin-bottom: 20px"
        />
        <el-form ref="ruleFormRef" label-width="100px" label-suffix=" :" :rules="rules" :model="fromModel">
          <el-form-item label="ç”¨æˆ·å¤´åƒ" prop="avatar">
            <UploadImg
              v-model:imageUrl="fromModel.avatar"
              @upload-img="uploadImg"
              width="135px"
              height="135px"
              :file-size="3"
            >
              <template #empty>
                <el-icon><Avatar /></el-icon>
                <span>è¯·ä¸Šä¼ å¤´åƒ</span>
              </template>
              <template #tip>å¤´åƒå¤§å°ä¸èƒ½è¶…è¿‡ 3M</template>
            </UploadImg>
          </el-form-item>
          <el-form-item label="ç”¨æˆ·ç…§ç‰‡" prop="photo">
            <UploadImgs
              v-model:fileList="fromModel.photo"
              @upload-img="uploadImg"
              :limit="3"
              height="140px"
              width="140px"
              border-radius="50%"
            >
              <template #empty>
                <el-icon><Picture /></el-icon>
                <span>è¯·ä¸Šä¼ ç…§ç‰‡</span>
              </template>
              <template #tip>æœ€å¤šä¸Šä¼  3 å¼ ç…§ç‰‡</template>
            </UploadImgs>
          </el-form-item>
          <el-form-item label="ç”¨æˆ·å§“å" prop="username">
            <el-input v-model="fromModel.username" placeholder="è¯·å¡«å†™ç”¨æˆ·å§“å" clearable></el-input>
          </el-form-item>
          <el-form-item label="èº«ä»½è¯å·" prop="idCard">
            <el-input v-model="fromModel.idCard" placeholder="è¯·å¡«å†™èº«ä»½è¯å·" clearable></el-input>
          </el-form-item>
          <el-form-item label="é‚®ç®±" prop="email">
            <el-input v-model="fromModel.email" placeholder="è¯·å¡«å†™é‚®ç®±" clearable></el-input>
          </el-form-item>
          <el-form-item>
            <el-button>å–æ¶ˆ</el-button>
            <el-button type="primary" @click="submit">ç¡®å®š</el-button>
          </el-form-item>
        </el-form>
      </div>
      <div class="upload-card">
        <el-alert
          title="å›¾ç‰‡ä¸Šä¼ ç»„ä»¶åœ¨ form è¡¨å•ä¸­ä½¿ç”¨ï¼Œå¦‚æœè¯¥è¡¨å•ç¦ç”¨ï¼Œåˆ™ä¸Šä¼ ç»„ä»¶ä¼šè‡ªåŠ¨ç¦ç”¨"
          type="warning"
          effect="dark"
          :closable="false"
          style="margin-bottom: 20px"
        />
        <el-form label-width="100px" label-suffix=" :" disabled :model="fromModel1">
          <el-form-item label="ç”¨æˆ·å¤´åƒ" prop="avatar">
            <UploadImg v-model:imageUrl="fromModel1.avatar" width="135px" height="135px" :file-size="3">
              <template #empty>
                <el-icon><Avatar /></el-icon>
                <span>è¯·ä¸Šä¼ å¤´åƒ</span>
              </template>
              <template #tip>å¤´åƒå¤§å°ä¸èƒ½è¶…è¿‡ 3M</template>
            </UploadImg>
          </el-form-item>
          <el-form-item label="ç”¨æˆ·ç…§ç‰‡" prop="photo">
            <UploadImgs
              v-model:fileList="fromModel1.photo"
              @upload-img="uploadImg"
              height="140px"
              width="140px"
              border-radius="50%"
            >
              <template #empty>
                <el-icon><Picture /></el-icon>
                <span>è¯·ä¸Šä¼ ç…§ç‰‡</span>
              </template>
              <template #tip>ç…§ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5M</template>
            </UploadImgs>
          </el-form-item>
          <el-form-item label="ç”¨æˆ·å§“å" prop="username">
            <el-input v-model="fromModel1.username" placeholder="è¯·å¡«å†™ç”¨æˆ·å§“å" clearable></el-input>
          </el-form-item>
          <el-form-item label="èº«ä»½è¯å·" prop="idCard">
            <el-input v-model="fromModel1.idCard" placeholder="è¯·å¡«å†™èº«ä»½è¯å·" clearable></el-input>
          </el-form-item>
          <el-form-item label="é‚®ç®±" prop="email">
            <el-input v-model="fromModel1.email" placeholder="è¯·å¡«å†™é‚®ç®±" clearable></el-input>
          </el-form-item>
          <el-form-item>
            <el-button>å–æ¶ˆ</el-button>
            <el-button type="primary" @click="submit">ç¡®å®š</el-button>
          </el-form-item>
        </el-form>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts" name="UploadImagesDemo">
import type { FormInstance } from "element-plus";
import UploadImg from "@/components/UploadImages/image.vue";
import UploadImgs, { type SuccessFun } from "@/components/UploadImages/images.vue";
import { uploadLocal } from "@/utils";

const fileList = ref([{ name: "img", url: "https://i.imgtg.com/2023/01/16/QRBHS.jpg" }]);
const fileList1 = ref([]);

const avatar1 = ref("");
const avatar2 = ref("");
const avatar3 = ref("");
const avatar4 = ref("");
const avatar5 = ref("https://i.imgtg.com/2023/01/16/QRqMK.jpg");

const rules = reactive({
  avatar: [{ required: true, message: "è¯·ä¸Šä¼ ç”¨æˆ·å¤´åƒ" }],
  photo: [{ required: true, message: "è¯·ä¸Šä¼ ç”¨æˆ·ç…§ç‰‡" }],
  username: [{ required: true, message: "è¯·å¡«å†™ç”¨æˆ·å§“å" }],
  idCard: [{ required: true, message: "è¯·å¡«å†™èº«ä»½è¯å·" }],
  email: [{ required: true, message: "è¯·å¡«å†™é‚®ç®±" }],
});

const fromModel = ref({
  avatar: "",
  photo: [{ name: "img", url: "https://i.imgtg.com/2023/01/16/QR57a.jpg" }],
  username: "",
  idCard: "",
  email: "",
});
const fromModel1 = ref({
  avatar: "",
  photo: [{ name: "img", url: "https://i.imgtg.com/2023/01/16/QR57a.jpg" }],
  username: "",
  idCard: "",
  email: "",
});
const ruleFormRef = ref<FormInstance>();
const submit = () => {
  ruleFormRef.value!.validate(valid => {
    console.log(valid);
  });
};

const uploadImg = async (file: File, callback: SuccessFun) => {
  // ä¸Šä¼ åˆ°æœ¬åœ°
  const { file: f } = await uploadLocal(file);
  const url = URL.createObjectURL(f);
  callback(url); // ä¼ å› url
};
</script>

<style lang="scss" scoped>
.upload-images-container {
  height: auto;

  .upload-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding: 20px;
    background-color: #ffffff;

    .upload-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      width: 90%;
      margin: 10px 0;
    }

    :deep(.el-descriptions) {
      width: 100%;
      padding: 40px 0 0;
    }
  }

  .upload-box {
    margin-bottom: 10px;
  }

  .upload-form-box {
    display: flex;
    justify-content: space-around;
    width: 100%;

    .upload-card {
      margin-right: 10px;

      &:last-child {
        margin-right: 0;
      }

      .el-form {
        width: 100%;
      }
    }
  }
}
</style>
